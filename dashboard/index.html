<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ted - Command Center</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23f59e0b'/><text x='50' y='68' text-anchor='middle' font-size='52' font-weight='bold' fill='%2309090b'>T</text></svg>">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header-brand">
      <div class="brand-logo">T</div>
      <div class="brand-text">
        <span class="brand-name">Ted</span>
        <span class="brand-subtitle">Command Center</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary btn-sm" onclick="openAgentPanel()" title="Manage Agents">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
        New Agent
      </button>
      <div class="status-badge">
        <span class="status-dot" id="status-dot"></span>
        <span id="status-text">Connecting...</span>
      </div>
      <button class="btn-icon" onclick="location.reload()" title="Refresh">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
      </button>
    </div>
  </header>

  <!-- STATS ROW -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon blue">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="stat-contacts">0</div>
        <div class="stat-label">CRM Contacts</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon green">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="stat-notes">0</div>
        <div class="stat-label">Notes</div>
      </div>
    </div>
    <div class="stat-card" onclick="showRemindersPopup()" style="cursor:pointer" title="Click to view reminders">
      <div class="stat-icon amber">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="stat-reminders">0</div>
        <div class="stat-label">Reminders</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon red">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="stat-due">0</div>
        <div class="stat-label">Overdue</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="stat-tags">0</div>
        <div class="stat-label">Tags</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon cyan">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      </div>
      <div class="stat-info">
        <div class="stat-value" id="stat-messages">0</div>
        <div class="stat-label">Messages</div>
      </div>
    </div>
  </div>

  <!-- MAIN LAYOUT -->
  <div class="main-layout">

    <!-- LEFT SIDEBAR -->
    <div class="sidebar">
      <div class="sidebar-tabs">
        <button class="sidebar-tab active" data-tab="groups" onclick="switchTab('groups')">Groups</button>
        <button class="sidebar-tab" data-tab="contacts" onclick="switchTab('contacts')">Contacts</button>
        <button class="sidebar-tab" data-tab="crm" onclick="switchTab('crm')">CRM</button>
      </div>
      <div class="sidebar-search">
        <div class="sidebar-search-wrap">
          <span class="search-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          </span>
          <input type="text" id="sidebar-search-input" placeholder="Search..." oninput="renderSidebar()">
        </div>
      </div>
      <div class="sidebar-list" id="sidebar-list">
        <div class="empty-state">Loading...</div>
      </div>
    </div>

    <!-- CENTER - MESSAGE FEED -->
    <div class="center-panel">
      <div class="feed-header">
        <div class="feed-target" id="composer-target">Select a group or contact</div>
        <select id="feed-period" onchange="loadMessages()">
          <option value="1h">1 Hour</option>
          <option value="24h" selected>24 Hours</option>
          <option value="7d">1 Week</option>
          <option value="30d">1 Month</option>
        </select>
      </div>
      <div class="feed" id="feed-body">
        <div class="empty-state">
          <div class="empty-state-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          </div>
          Select a group or contact to view messages
        </div>
      </div>
      <!-- Composer -->
      <div class="composer-bar" style="position: relative;">
        <div class="quick-replies-popup" id="qr-popup"></div>
        <button class="btn-mode" id="btn-send-as" onclick="toggleSendAs()" title="Switch: You / Ted">You</button>
        <textarea id="msg-text" placeholder="Write a message... (type / for quick replies)" rows="1" onkeydown="handleComposerKey(event)" oninput="handleComposerInput(event)"></textarea>
        <button class="btn-send-msg" id="btn-send" onclick="sendTextMessage()" title="Send">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right-panel">
      <div class="right-tabs">
        <button class="right-tab active" data-rtab="crm" onclick="switchRightTab('crm')">CRM</button>
        <button class="right-tab" data-rtab="tools" onclick="switchRightTab('tools')">Tools</button>
      </div>

      <!-- CRM Content -->
      <div class="right-content" id="right-crm" style="display: flex;">
        <div class="crm-panel-body" id="crm-panel-body">
          <div class="empty-state">
            <div class="empty-state-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
            </div>
            Select a contact to view CRM profile
          </div>
        </div>
      </div>

      <!-- Tools Content -->
      <div class="right-content" id="right-tools" style="display: none;">
        <div class="tools-body">
          <!-- AI Image Generator -->
          <div class="tool-card">
            <div class="tool-card-header">
              <div class="tool-card-icon purple">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
              </div>
              <div class="tool-card-title">AI Image Generator</div>
            </div>
            <div class="ai-input-wrap">
              <input type="text" id="ai-prompt" placeholder="Describe an image..." onkeypress="if(event.key==='Enter')generateImage()">
            </div>
            <div class="ai-actions">
              <button class="btn btn-secondary btn-sm" onclick="generateImage()">Generate</button>
              <button class="btn btn-primary btn-sm" id="btn-send-image" onclick="sendAiImage()" disabled>Send Image</button>
            </div>
            <div class="ai-preview" id="ai-preview"></div>
          </div>

          <!-- Quick Replies Manager -->
          <div class="tool-card">
            <div class="tool-card-header">
              <div class="tool-card-icon cyan">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
              </div>
              <div class="tool-card-title">Quick Replies</div>
            </div>
            <div id="qr-manage-list" class="qr-manage-list"></div>
            <div class="inline-add" style="flex-wrap: wrap;">
              <input type="text" id="qr-new-shortcut" placeholder="Shortcut" style="max-width: 90px;" onkeypress="if(event.key==='Enter')document.getElementById('qr-new-text').focus()">
              <input type="text" id="qr-new-text" placeholder="Reply text..." onkeypress="if(event.key==='Enter')addQuickReply()">
              <button class="btn btn-sm btn-primary" onclick="addQuickReply()">Add</button>
            </div>
            <div style="font-size: 11px; color: var(--text-dim); margin-top: 8px;">Type <strong>/</strong> in the composer to use quick replies</div>
          </div>

          <!-- Quick Actions -->
          <div class="tool-card">
            <div class="tool-card-header">
              <div class="tool-card-icon cyan">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
              </div>
              <div class="tool-card-title">Quick Actions</div>
            </div>
            <button class="btn btn-secondary btn-sm tool-action-btn" onclick="summarizeChat()">Summarize Chat</button>
            <button class="btn btn-secondary btn-sm tool-action-btn" onclick="exportMessages()">Export Messages</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- AGENT PANEL MODAL -->
  <div class="modal-overlay" id="agent-modal" style="display:none;" onclick="if(event.target===this)closeAgentPanel()">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Agent Management</h3>
        <button class="modal-close" onclick="closeAgentPanel()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <div id="agents-list"></div>
        <div class="agent-divider">Add New Agent</div>
        <div class="agent-add-form" id="agent-add-form">
          <div class="form-field">
            <label>Agent Name</label>
            <input type="text" id="agent-name-input" placeholder="e.g. Sales Bot">
          </div>
          <div class="form-field">
            <label>Phone Number</label>
            <input type="text" id="agent-phone-input" placeholder="e.g. +972501234567">
          </div>
          <button class="btn btn-primary" onclick="addNewAgent()" style="width: 100%; margin-top: 4px;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
            Connect WhatsApp
          </button>
          <div id="qr-container"></div>
        </div>
        <div class="agent-info-box">
          <p>How it works</p>
          <ul class="agent-info-list">
            <li>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>
              Each agent gets its own WhatsApp connection
            </li>
            <li>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M7 7h.01M7 12h.01M7 17h.01M12 7h.01M12 12h.01M12 17h.01M17 7h.01M17 12h.01M17 17h.01"/></svg>
              Scan QR code to link the number
            </li>
            <li>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
              Separate message store per agent
            </li>
            <li>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
              Switch between agents from the dashboard
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
</body>
</html>
